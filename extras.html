<!DOCTYPE html>
<html lang="ja">

<head>
    <title>p5.js</title>
    <style>
        body {
            margin: 0;
            /* ‰ΩôÁôΩ„ÇíÂÆåÂÖ®„Å´ÂâäÈô§ */
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.1/lib/p5.min.js"></script>
</head>

<body>

    <script>

        let circleX, circleY, circleRadius;
        let circleMaximumRadius;
        let score = 0;
        let highScore;
        let circleType; // 0=Âä†ÁÇπ, 1=Ê∏õÁÇπ
        let imgAdd, imgSub; // Âä†ÁÇπ„ÉªÊ∏õÁÇπÁî®ÁîªÂÉè
        let gameState = "start"; // "start", "playing", "gameover"
        let startTime; // „Ç≤„Éº„É†ÈñãÂßãÊôÇÂàªÔºà„Éü„É™ÁßíÔºâ

        function preload() {
            imgAdd = loadImage('add.png');   // Âä†ÁÇπÁîªÂÉè
            imgSub = loadImage('sub.png');   // Ê∏õÁÇπÁîªÂÉè
        }

        function setup() {
            createCanvas(windowWidth, windowHeight); // ÁîªÈù¢„Çµ„Ç§„Ç∫„ÅÑ„Å£„Å±„ÅÑ
            textSize(36);
            textAlign(CENTER, CENTER);

            // ‰øùÂ≠òÊ∏à„Åø„Éè„Ç§„Çπ„Ç≥„Ç¢„ÇíÂèñÂæó
            highScore = getItem('highScore');
            if (highScore === null) {
                highScore = 0;
            }
        }

        function draw() {
            background(20);

            if (gameState === "start") {
                showStartScreen();
            } else if (gameState === "playing") {
                imageMode(CENTER);
                if (circleType === 0) {
                    image(imgAdd, circleX, circleY, circleRadius * 2, circleRadius * 2);
                } else {
                    image(imgSub, circleX, circleY, circleRadius * 2, circleRadius * 2);
                }

                circleRadius -= 1;
                if (circleRadius <= 0) {
                    resetCircle(); // ÂÜÜ„ÅåÊ∂à„Åà„Åü„Çâ„É™„Çª„ÉÉ„ÉàÔºà„Ç≤„Éº„É†„Ç™„Éº„Éê„Éº„Å´„ÅØ„Åó„Å™„ÅÑÔºâ
                }

                // „Çπ„Ç≥„Ç¢Ë°®Á§∫
                fill(220);
                textSize(36);
                textAlign(RIGHT, TOP);
                text(score, width - 20, 20);

                // ÊÆã„ÇäÊôÇÈñìË°®Á§∫
                let elapsed = (millis() - startTime) / 1000;
                let remaining = max(0, 10 - int(elapsed));
                textAlign(LEFT, TOP);
                text(`Time: ${remaining}`, 20, 20);

                // 10ÁßíÁµåÈÅé„ÅßÁµÇ‰∫Ü
                if (elapsed >= 10) {
                    endGame();
                }
            } else if (gameState === "gameover") {
                showEndScreen();
            }
        }

        function startGame() {
            score = 0;
            circleMaximumRadius = min(width, height) / 6;
            resetCircle();
            startTime = millis(); // ÈñãÂßãÊôÇÂàªË®òÈå≤
            gameState = "playing";
        }

        function resetCircle() {
            circleRadius = circleMaximumRadius;
            circleX = random(circleRadius, width - circleRadius);
            circleY = random(circleRadius, height - circleRadius);
            circleType = random([0, 1]); // „É©„É≥„ÉÄ„É†„Å´Âä†ÁÇπ„ÉªÊ∏õÁÇπ
        }

        function mousePressed() {
            if (gameState === "start" || gameState === "gameover") {
                startGame();
                return;
            }

            if (gameState === "playing") {
                let distanceToCircle = dist(mouseX, mouseY, circleX, circleY);

                if (distanceToCircle < circleRadius) {
                    if (circleType === 0) {
                        score += 1;
                    } else {
                        score = max(score - 1, 0);
                    }
                    resetCircle();
                } else {
                    resetCircle(); // Â§ñ„ÇØ„É™„ÉÉ„ÇØ„Åß„Çπ„Ç≠„ÉÉ„Éó
                }
            }
        }

        function endGame() {
            // „Éè„Ç§„Çπ„Ç≥„Ç¢Êõ¥Êñ∞
            highScore = max(highScore, score);
            storeItem('highScore', highScore);
            gameState = "gameover";
        }

        function showStartScreen() {
            fill(220);
            textAlign(CENTER, CENTER);
            textSize(28);
            let startText = `üëä Clicker
üëä ‚Üí ‚≠ïÔ∏è   üî• ‚Üí ‚ùå

High Score: ${highScore}
Click to play`;
            text(startText, width / 2, height / 2);
        }

        function showEndScreen() {
            fill(220);
            textAlign(CENTER, CENTER);
            textSize(28);
            let endText = `Finish!

Score: ${score}
High Score: ${highScore}
Click to restart`;
            text(endText, width / 2, height / 2);
        }
        //         let circleX;
        //         let circleY;
        //         let circleRadius;
        //         let circleMaximumRadius;
        //         let circleColor;
        //         let score = 0;
        //         let highScore;

        //         // 0 = Âä†ÁÇπ, 1 = ÂéüÁÇπÔºà„Ç≤„Éº„É†„Ç™„Éº„Éê„ÉºÊâ±„ÅÑÔºâ
        //         let circleType;

        //         let img;

        //         function preload() {
        //             img = loadImage('example.png'); // ÁîªÂÉè„Éï„Ç°„Ç§„É´„ÇíË™≠„ÅøËæº„ÇÄ
        //         }

        //         function draw() {
        //             background(20);

        //             // ÁîªÂÉè„ÇíÂÜÜ„ÅÆ‰ΩçÁΩÆ„Éª„Çµ„Ç§„Ç∫„Å´Âêà„Çè„Åõ„Å¶ÊèèÁîª
        //             imageMode(CENTER);
        //             image(img, circleX, circleY, circleRadius * 2, circleRadius * 2);
        //         }

        //         function setup() {
        //             createCanvas(720, 400);
        //             colorMode(HSB);
        //             noStroke();
        //             ellipseMode(RADIUS);
        //             textSize(36);

        //             // Get the last saved high score
        //             highScore = getItem('high score');

        //             // If no score was saved, start with a value of 0
        //             if (highScore === null) {
        //                 highScore = 0;
        //             }
        //         }

        //         function draw() {
        //             background(20);

        //             // If the circle had not shrunk completely
        //             if (circleRadius > 0) {
        //                 // Draw the circle
        //                 fill(circleColor);
        //                 circle(circleX, circleY, circleRadius);
        //                 describeElement('Circle', 'Randomly colored shrinking circle');

        //                 // Shrink it
        //                 circleRadius -= 1;

        //                 // Show the score
        //                 textAlign(RIGHT, TOP);
        //                 fill(220);
        //                 text(score, width - 20, 20);
        //                 describeElement('Score', `Text with current score: ${score}`);
        //             } else {
        //                 // Otherwise show the start/end screen
        //                 endGame();
        //             }
        //         }

        //         function startGame() {
        //             // Reset the score to 0
        //             score = 0;

        //             // Start with the circle's radius maximum at half the minimum canvas dimension
        //             circleMaximumRadius = min(height / 2, width / 2);
        //             resetCircle();
        //         }

        //         function endGame() {
        //             // Pause the sketch
        //             noLoop();

        //             // Store the new high score
        //             highScore = max(highScore, score);
        //             storeItem('high score', highScore);

        //             textAlign(CENTER, CENTER);
        //             fill(220);
        //             let startText = `Circle Clicker
        //   Click the circle before it gets too small
        //   Score: ${score}
        //   High score: ${highScore}
        //   Click to play`;
        //             text(startText, 0, 0, width, height);
        //             describeElement('Start text', `Text reading, "${startText}"`);
        //         }

        //         // function resetCircle() {
        //         //     // Start with the circle's radius at its maximum value
        //         //     circleRadius = circleMaximumRadius;
        //         //     circleX = random(circleRadius, width - circleRadius);
        //         //     circleY = random(circleRadius, height - circleRadius);
        //         //     circleColor = color(random(240, 360), random(40, 80), random(50, 90));
        //         // }

        //         function resetCircle() {
        //             circleRadius = circleMaximumRadius;
        //             circleX = random(circleRadius, width - circleRadius);
        //             circleY = random(circleRadius, height - circleRadius);

        //             // 0 = Âä†ÁÇπ„ÄÅ1 = ÂéüÁÇπ
        //             circleType = random([0, 1]);

        //             if (circleType === 0) {
        //                 circleColor = color(random(180, 240), 80, 90); // ÈùíÁ≥ª
        //             } else {
        //                 circleColor = color(0, 80, 90); // Ëµ§Á≥ª
        //             }
        //         }

        //         function mousePressed() {
        //             // // If the game is unpaused
        //             // if (isLooping() === true) {
        //             //     // Check how far the mouse is from the circle
        //             //     let distanceToCircle = dist(mouseX, mouseY, circleX, circleY);

        //             //     // If the mouse is closer to the circle's center than the circle's radius,
        //             //     // that means the player clicked on it
        //             //     if (distanceToCircle < circleRadius) {
        //             //         // Decrease the maximum radius, but don't go below 15
        //             //         circleMaximumRadius = max(circleMaximumRadius - 1, 15);
        //             //         resetCircle();

        //             //         // Give the player a point
        //             //         score += 1;
        //             //     }
        //             //     // If the game is paused
        //             // } else {
        //             //     // Start and unpause it
        //             //     startGame();
        //             //     loop();
        //             // }

        //             // „Ç≤„Éº„É†„ÅåÈñãÂßã„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØ„Çπ„Çø„Éº„Éà
        //             if (!isLooping()) {
        //                 startGame();
        //                 loop();
        //                 return;
        //             }

        //             // „ÇØ„É™„ÉÉ„ÇØ‰ΩçÁΩÆ„Å®ÂÜÜ„ÅÆË∑ùÈõ¢
        //             let distanceToCircle = dist(mouseX, mouseY, circleX, circleY);

        //             if (distanceToCircle < circleRadius) {
        //                 // ÂÜÜ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„ÅüÂ†¥Âêà
        //                 if (circleType === 0) {
        //                     // Âä†ÁÇπ‰∏∏
        //                     circleMaximumRadius = max(circleMaximumRadius - 1, 15);
        //                     score += 1;
        //                 } else {
        //                     // Ê∏õÁÇπ‰∏∏
        //                     score = max(score - 1, 0); // „Çπ„Ç≥„Ç¢„ÅØ0Êú™Ê∫Ä„Å´„Å™„Çâ„Å™„ÅÑ
        //                 }
        //                 resetCircle();
        //             } else {
        //                 // ÂÜÜ‰ª•Â§ñ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„ÅüÂ†¥Âêà ‚Üí „Çπ„Ç≠„ÉÉ„Éó
        //                 resetCircle();
        //             }
        //         }
    </script>

</body>

</html>